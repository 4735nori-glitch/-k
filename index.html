<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰›ç›¸å ´ãƒ»å®Œå…¨è¨ˆç®—æ©Ÿ</title>
    <style>
        body { background-color: #2c3e50; color: white; font-family: sans-serif; text-align: center; padding: 15px; }
        .container { background: #34495e; padding: 20px; border-radius: 15px; display: inline-block; width: 100%; max-width: 400px; box-sizing: border-box; }
        label { display: block; text-align: left; font-size: 14px; color: #bdc3c7; margin-top: 10px; }
        input { width: 100%; padding: 12px; margin: 5px 0; border-radius: 5px; border: none; font-size: 18px; box-sizing: border-box; background: #ecf0f1; }
        
        .calc-box { background: #27ae60; padding: 15px; border-radius: 10px; margin: 20px 0; font-weight: bold; text-align: left; }
        .result-line { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 16px; }
        .highlight { font-size: 24px; color: #f1c40f; border-top: 1px solid rgba(255,255,255,0.3); padding-top: 10px; margin-top: 10px; }
        
        button { background: #e67e22; color: white; border: none; padding: 15px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; font-size: 18px; margin-top: 10px; }
        #log-area { margin-top: 20px; text-align: left; background: #ecf0f1; color: #333; padding: 10px; border-radius: 10px; height: 300px; overflow-y: auto; }
        .log-item { border-bottom: 2px solid #bdc3c7; padding: 10px 0; font-size: 14px; line-height: 1.5; }
        .log-price { color: #c0392b; font-weight: bold; font-size: 16px; }
    </style>
</head>
<body>

    <h1>ğŸ„ ç‰›ç›¸å ´ãƒ»å®Œå…¨è¨ˆç®—æ©Ÿ</h1>
    
    <div class="container">
        <label>ç‰›ã®å€‹ä½“è­˜åˆ¥ãƒ»åå‰</label>
        <input type="text" id="cowName" placeholder="ä¾‹ï¼š302å·">
        
        <label>ä½“é‡ (kg)</label>
        <input type="number" id="weight" placeholder="500" oninput="recalc('w')">
        
        <label>ã‚­ãƒ­å˜ä¾¡ (å††)</label>
        <input type="number" id="unitPrice" placeholder="2500" oninput="recalc('u')">
        
        <label>å£²å€¤ï¼ˆç¨æŠœç·é¡ï¼‰(å††)</label>
        <input type="number" id="subtotalInput" placeholder="1250000" oninput="recalc('s')">
        
        <div class="calc-box">
            <div class="result-line"><span>ç¨æŠœå˜ä¾¡ï¼š</span><span>Â¥ <span id="res-unit">0</span></span></div>
            <div class="result-line"><span>æ¶ˆè²»ç¨(10%)ï¼š</span><span>Â¥ <span id="res-tax">0</span></span></div>
            <div class="highlight">
                ç¨è¾¼åˆè¨ˆï¼šÂ¥ <span id="res-total">0</span>
            </div>
        </div>

        <button id="save-btn">ã“ã®å–å¼•ã‚’è¨˜éŒ²ï¼</button>
        
        <div id="log-area">
            <strong>ğŸ“Š å–å¼•å±¥æ­´ï¼š</strong>
            <div id="log-list"></div>
        </div>
        <br>
        <button id="clear-btn" style="background:#c0392b; font-size:12px; width:auto; color:white;">å±¥æ­´å…¨æ¶ˆå»</button>
    </div>

    <script>
        const saveBtn = document.getElementById('save-btn');
        const list = document.getElementById('log-list');

        // ãƒ¢ãƒ¼ãƒ‰ã«åˆã‚ã›ã¦é€†ç®—ã™ã‚‹é–¢æ•°
        function recalc(mode) {
            const w = parseFloat(document.getElementById('weight').value) || 0;
            let u = parseFloat(document.getElementById('unitPrice').value) || 0;
            let s = parseFloat(document.getElementById('subtotalInput').value) || 0;

            if (mode === 'w' || mode === 'u') {
                // ä½“é‡ã‹å˜ä¾¡ã‚’å…¥ã‚ŒãŸã‚‰ã€ç·é¡ã‚’è¨ˆç®—
                s = Math.floor(w * u);
                document.getElementById('subtotalInput').value = s || "";
            } else if (mode === 's') {
                // ç·é¡ã‚’å…¥ã‚ŒãŸã‚‰ã€å˜ä¾¡ã‚’é€†ç®—
                u = w > 0 ? Math.floor(s / w) : 0;
                document.getElementById('unitPrice').value = u || "";
            }

            const tax = Math.floor(s * 0.1);
            const total = s + tax;

            document.getElementById('res-unit').innerText = u.toLocaleString();
            document.getElementById('res-tax').innerText = tax.toLocaleString();
            document.getElementById('res-total').innerText = total.toLocaleString();
            
            return { w, u, s, tax, total };
        }

        window.onload = () => {
            const savedData = JSON.parse(localStorage.getItem('cowMasterLogs')) || [];
            savedData.forEach(item => addToList(item));
        };

        saveBtn.addEventListener('click', () => {
            const name = document.getElementById('cowName').value || "æœªè¨­å®š";
            const data = recalc('w'); // ç¾åœ¨ã®å€¤ã‚’å–å¾—

            if(data.s === 0) return alert("æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã‚Œï¼");

            const date = new Date().toLocaleString();
            const logEntry = `ã€${date}ã€‘ ${name} (${data.w}kg)<br>
                å˜ä¾¡:${data.u.toLocaleString()}å†† / ç·é¡(æŠœ):${data.s.toLocaleString()}å††<br>
                <span class="log-price">ç¨è¾¼åˆè¨ˆï¼š${data.total.toLocaleString()}å††</span> (ç¨:${data.tax.toLocaleString()}å††)`;

            const savedData = JSON.parse(localStorage.getItem('cowMasterLogs')) || [];
            savedData.push(logEntry);
            localStorage.setItem('cowMasterLogs', JSON.stringify(savedData));

            addToList(logEntry);
            
            // å…¥åŠ›ãƒªã‚»ãƒƒãƒˆ
            ["cowName","weight","unitPrice","subtotalInput"].forEach(id => document.getElementById(id).value = "");
            recalc('w');
        });

        function addToList(html) {
            const div = document.createElement('div');
            div.className = 'log-item';
            div.innerHTML = html;
            list.prepend(div);
        }

        document.getElementById('clear-btn').addEventListener('click', () => {
            if(confirm("å…¨ãƒ‡ãƒ¼ã‚¿ã‚’æŠ¹æ¶ˆã—ã¾ã™ã‹ï¼Ÿ")) {
                localStorage.clear();
                location.reload();
            }
        });
    </script>
</body>
</html>
